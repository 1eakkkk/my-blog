
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 禁止浏览器缓存当前页面 -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- 核心修复：添加 user-scalable=no, maximum-scale=1.0 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>1eak.cool | 数字基地</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>💠</text></svg>">
    <link rel="stylesheet" href="style.css?v=6.0">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Markdown 解析库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- XSS 净化库 (安全必须) -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
    <style>
        #loading-mask {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background-color: #000; z-index: 99999;
            display: flex; justify-content: center; align-items: center;
            color: #0070f3; font-family: 'JetBrains Mono', monospace; font-size: 1.2rem;
            flex-direction: column; text-align: center;
        }
        .loading-spinner {
            width: 40px; height: 40px; border: 3px solid #333;
            border-top: 3px solid #0070f3; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fallback-btn {
            margin-top: 20px; padding: 10px 20px; border: 1px solid #333;
            background: transparent; color: #fff; cursor: pointer; display: none;
        }
    </style>
</head>
<body>

    <div id="toast-container"></div>
    <div id="loading-mask">
        <div class="loading-spinner" id="spinner"></div>
        <div id="loading-text">SYSTEM SECURITY CHECK...</div>
        <button class="fallback-btn" onclick="window.location.href='/login.html'">强制跳转登录</button>
    </div>
    <script>
        setTimeout(() => {
            const mask = document.getElementById('loading-mask');
            if (mask && mask.style.opacity !== '0') {
                document.getElementById('loading-text').innerHTML = "CONNECTION TIMEOUT";
                document.querySelector('.fallback-btn').style.display = 'block';
            }
        }, 5000);
    </script>

    <div class="bg-grid"></div>
    <div class="mobile-menu-btn" id="mobileMenuBtn">☰</div>

    <!-- 全服播报 HUD 显示层 (默认隐藏) -->
    <div id="broadcast-hud" class="broadcast-overlay" style="display:none;">
        <div class="hud-center-box" id="hudBox">
            <!-- 装饰性扫描线 -->
            <div class="hud-scan-line"></div>
            <!-- 顶部小字 -->
            <div class="hud-label">SYSTEM BROADCAST // <span id="hudUser">UNKNOWN</span></div>
            <!-- 核心内容 -->
            <div class="hud-content" id="hudContent">HELLO WORLD</div>
            <!-- 底部装饰 -->
            <div class="hud-footer-deco">
                <span class="dot">●</span> <span class="line"></span> <span class="dot">●</span>
            </div>
        </div>
    </div>

    <!-- 道具使用弹窗 (输入文字/选颜色) -->
    <div id="item-use-modal" class="modal-overlay" style="display:none;">
        <div class="modal-card glass-card">
            <h3>使用：骇客宣言卡</h3>
            <p style="color:#888; font-size:0.8rem; margin-bottom:15px;">全服玩家进入网站时可见，持续24小时。</p>
            
            <input type="text" id="broadcastInput" class="cyber-input" placeholder="输入宣言 (限20字)..." maxlength="20">
            
            <div style="margin-bottom:15px; text-align:left;">
                <label style="font-size:0.8rem; color:#aaa;">文字颜色特效：</label>
                <div class="color-picker-row">
                    <div class="color-dot" style="background:#fff" onclick="selectBroadcastColor('#ffffff', this)"></div>
                    <div class="color-dot" style="background:#00f3ff" onclick="selectBroadcastColor('#00f3ff', this)"></div>
                    <div class="color-dot" style="background:#bd00ff" onclick="selectBroadcastColor('#bd00ff', this)"></div>
                    <div class="color-dot" style="background:#ff3333" onclick="selectBroadcastColor('#ff3333', this)"></div>
                    <div class="color-dot rainbow-dot" onclick="selectBroadcastColor('rainbow', this)">🌈</div>
                </div>
            </div>
            
            <div style="display:flex; gap:10px;">
                <button onclick="closeItemModal()" class="cyber-btn" style="border-color:#666; color:#888;">取消</button>
                <button onclick="submitBroadcast()" class="cyber-btn">提交审核</button>
            </div>
        </div>
    </div>

    <!-- 加入对局弹窗 (Join Duel Modal) -->
    <div id="join-duel-modal" class="modal-overlay" style="display:none;">
        <div class="modal-card glass-card" style="text-align:center; max-width: 350px;">
            <h3 style="color:#fff; margin-bottom:5px;">接受挑战 // ACCEPT DUEL</h3>
            <p style="color:#888; font-size:0.8rem;">选择你的数据武器进行对抗</p>
            
            <!-- 修改后：里面加了图标 -->
            <div class="join-modal-grid">
                <!-- ⚔️ 剪刀 -->
                <div class="join-option opt-blade" onclick="selectJoinMove('blade', this)"></div>
                <!-- 🧊 石头 -->
                <div class="join-option opt-cube" onclick="selectJoinMove('cube', this)"></div>
                <!-- 📄 布 -->
                <div class="join-option opt-membrane" onclick="selectJoinMove('membrane', this)"></div>
            </div>
    
            <!-- 隐藏域存储数据 -->
            <input type="hidden" id="joinDuelIdVal">
            <input type="hidden" id="joinMoveVal">
    
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button onclick="closeJoinModal()" class="cyber-btn" style="border-color:#666; color:#888;">取消</button>
                <button onclick="confirmJoinDuel()" class="cyber-btn" style="border-color:#ff3333; color:#ff3333;">FIGHT!</button>
            </div>
        </div>
    </div>

    <!-- ⚔️ 对战动画全屏遮罩 (如果你的代码里没有这一段，回放绝对不会显示) ⚔️ -->
    <div id="duel-overlay" class="duel-overlay" style="display:none;">
        <div class="arena-stage">
            <!-- 左侧: 我方 -->
            <div class="arena-player left">
                <div class="player-name" id="arenaP1Name">YOU</div>
                <div class="data-orb" id="orbP1"></div>
            </div>
                
            <!-- 中间: 对撞区 -->
            <div class="arena-center">
                <div class="vs-text">VS</div>
                <div class="collision-flash" id="collisionFlash"></div>
            </div>
                
            <!-- 右侧: 敌方 -->
            <div class="arena-player right">
                <div class="player-name" id="arenaP2Name">OPPONENT</div>
                <div class="data-orb" id="orbP2"></div>
            </div>
        </div>
                    
           <!-- 结果结算面板 -->
        <div id="duelResultPanel" class="duel-result-panel" style="display:none;">
            <h1 id="duelResultTitle">VICTORY</h1>
            <div id="duelResultDetail" style="margin-bottom:20px; color:#ccc;">+198 iCoins</div>
            <button onclick="closeDuelOverlay()" class="cyber-btn" style="border-color:#fff; color:#fff; width:auto; padding:10px 30px;">CLOSE</button>
        </div>
    </div>

    <div class="app-container">
        <!-- 侧边栏 -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">1EAK<span class="dot">.</span>COOL</div>
            
            <div class="user-card" id="userCard">
                <div class="user-header-row">
                    <div id="avatarContainer"></div>
                    <div class="user-info">
                        <h3 id="username">LOADING...</h3>
                        <div id="badgesArea"></div>
                            <!-- 新增：个性签名展示 -->
                        <div id="userBioDisplay" style="font-size:0.75rem; color:#888; margin-top:8px; font-style:italic; word-break:break-all;"></div>
                    </div>
                </div>
                <div class="xp-container">
                    <div class="xp-info"><span>XP</span><span id="xpText">0 / 100</span></div>
                    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xpBar"></div></div>
                </div>
            </div>
            
            <!-- 侧边栏导航区域 -->
            <nav>
                <!-- 首页 -->
                <a href="#home" class="nav-link active">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    首页
                </a>

                <!-- 消息 (带红点) -->
                <a href="#notifications" class="nav-link" id="navNotify" style="display:flex; align-items:center;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                    <span style="flex:1">消息</span>
                    <span id="notifyBadge" class="notify-badge" style="display:none">0</span>
                </a>

                <!-- 任务中心 -->
                <a href="#tasks" class="nav-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    任务中心
                </a>

                <!-- 排行榜 -->
                <a href="#leaderboard" class="nav-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M18 20V10"></path><path d="M12 20V4"></path><path d="M6 20v-6"></path></svg>
                    排行榜
                </a>

                <!-- N.O.D.E 控制台 -->
                <a href="#node" class="nav-link" style="color: #00ff00;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M2 12h20"></path><path d="M2 12l5 5"></path><path d="M2 12l5-5"></path><circle cx="12" cy="12" r="3"></circle><path d="M22 12l-5 5"></path><path d="M22 12l-5-5"></path></svg>
                    N.O.D.E 控制台
                </a>

                <a href="#duel" class="nav-link" style="color: #ff3333;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                    数据格斗场
                </a>
                
                <!-- 私信与好友 -->
                <a href="#chat" class="nav-link" id="navChat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    私信与好友
                    <span id="chatBadge" class="notify-badge" style="display:none; background-color:#ff00de;">0</span>
                </a>

                <!-- 发帖入口 -->
                <a href="#write" class="nav-link" id="navWrite">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    发帖入口
                </a>

                <!-- 道具商城 (金色文字) -->
                <a href="#shop" class="nav-link" style="color:#FFD700;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                    道具商城
                </a>

                <!-- 个人背包 -->
                <a href="#inventory" class="nav-link" id="navInventory">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M20 14.66V20a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V14.66"></path><path d="M16 11V8a4 4 0 0 0-8 0v3"></path><rect x="4" y="11" width="16" height="4" rx="2"></rect></svg>
                    个人背包
                </a>

                <!-- 反馈中心 -->
                <a href="#feedback" class="nav-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                    反馈中心
                </a>

                <!-- 我的主页 -->
                <a href="#profile?u=" id="navMyProfile" class="nav-link" onclick="if(currentUser) this.href='#profile?u='+currentUser.username">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    我的主页
                </a>

                <!-- 个人设置 -->
                <a href="#settings" class="nav-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    个人设置
                </a>

                <!-- 关于 -->
                <a href="#about" class="nav-link">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    关于
                </a>

                <!-- 管理后台 (红字) -->
                <a href="#admin" class="nav-link" id="navAdmin" style="display:none; color:#ff3333; justify-content:space-between; align-items:center;">
                    <div style="display:flex; align-items:center">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                        <span>管理后台</span>
                    </div>
                    <span id="adminFeedbackBadge" class="notify-badge" style="display:none; background-color: gold; color: black;">0</span>
                </a>
            </nav>

            <div class="vip-sidebar-box" id="vipBox">
                <h4>VIP ACCESS</h4>
                <p>解锁经验加成</p>
                <button onclick="buyVip()" class="vip-mini-btn">UPGRADE</button>
            </div>

            <div class="status-panel">
                <div class="status-item">
                    <span>i 币</span>
                    <span class="value blue" id="coinCount">-</span>
                </div>
                <button id="checkInBtn" class="cyber-btn">每日签到 (+XP)</button>
                <button onclick="doLuckyDraw()" class="lucky-draw-btn">🎲 每日幸运抽奖</button>
            </div>
        </aside>

        <!-- 主内容区 -->
        <main class="content">
            <header>
                <div class="breadcrumbs" id="breadcrumbs">SYSTEM // HOME</div>
                <div class="date-display" id="clock">00:00:00</div>
            </header>

            <div id="view-container">
                <!-- 1. 首页 -->
                <div id="view-home" class="view-section active">
                    <div class="hero-section">
                        <h1>DATA STREAM</h1>
                        <p>这里是 1eak 的数字思维空间。</p>
                    </div>
                    <!-- 搜索与排序工具栏 -->
                    <div class="toolbar" style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="text" id="searchInput" class="cyber-input" placeholder="搜索关键词..." style="flex: 2; margin: 0;">
                        <select id="sortSelect" class="cyber-input" style="flex: 1; margin: 0; min-width: 120px; color: var(--accent-blue);">
                            <option value="latest">最新</option>
                            <option value="hot">热度</option>
                            <option value="comments">热议</option>
                        </select>
                        <button onclick="searchPosts()" class="cyber-btn" style="width: auto; margin: 0;">GO</button>
                    </div>
                    <div id="posts-list" class="posts-grid"></div>
                    <button id="loadMoreBtn" class="cyber-btn" onclick="loadPosts(false)" style="display:none; margin: 20px auto; max-width: 300px;">加载更多</button>
                </div>

                <!-- N.O.D.E 控制台视图 (Void Theme) -->
                <div id="view-node" class="view-section" style="display:none;">
                    <div class="node-console-wrapper">
                        <div class="node-header">
                            <h2>N.O.D.E // SYSTEM</h2>
                            <div class="node-status">LINK: <span id="nodeUser">...</span></div>
                        </div>
                        <!-- 新增：全服广播跑马灯 -->
                        <div class="node-broadcast">
                            <span class="broadcast-content" id="nodeTicker">SYSTEM ONLINE... WAITING FOR SIGNALS...</span>
                        </div>
                    
                        <!-- 雷达可视区域 -->
                        <div class="node-visualizer">
                            <div class="radar-circle"></div>
                            <div class="radar-line"></div>
                            
                            <!-- 装饰点 -->
                            <div class="node-point" style="top:25%; left:25%"></div>
                            <div class="node-point" style="top:75%; left:65%"></div>
                            <div class="node-point" style="top:35%; left:80%"></div>
                
                            <!-- 核心交互按钮 -->
                            <div id="centralNode" class="central-node" onclick="exploreNode()">
                            </div>
                        </div>
                
                        <!-- 控制面板 -->
                        <div class="node-controls">
                            <p id="nodeCostDisplay">CALIBRATING...</p>
                            <button id="exploreBtn" onclick="exploreNode()">
                                START SEQUENCE
                            </button>
                        </div>
                
                        <!-- 日志终端 -->
                        <div class="console-log" id="nodeLog">
                            <div class="log-line">> SYSTEM INITIALIZED...</div>
                            <div class="log-line">> AWAITING COMMAND...</div>
                        </div>
                    </div>
                </div>

                <!-- 数据格斗场视图 -->
                <div id="view-duel" class="view-section" style="display:none;">
                    <div class="duel-wrapper">
                        <div class="duel-header">
                            <h2>DATA DUEL ARENA // 数据格斗</h2>
                            <div style="font-size:0.8rem; color:#666;">WARNING: 高风险数据交换区 (TAX: 1%)</div>
                        </div>
                
                        <!-- 顶部操作区 (Triangle UI) -->
                        <div class="duel-controls glass-card">
                            <div style="display:flex; align-items:center; justify-content:center;">
                                <!-- 金额输入 -->
                                <div style="display:flex; flex-direction:column; align-items:center;">
                                    <label style="font-size:0.7rem; color:#666; margin-bottom:5px;">STAKE // 赌注</label>
                                    <input type="number" id="duelBetAmount" class="cyber-input" placeholder="10 - 1000" style="width:100px; margin:0; text-align:center;">
                                </div>
                
                                <!-- 三角形选择器 -->
                                <div class="rps-triangle-container" id="rpsTriangle">
                                    <div class="rps-triangle-bg"></div> <!-- 装饰背景 -->
                                    <!-- 以后你可以把 innerHTML 换成 <img src="..."> -->
                                    <div class="rps-btn" data-val="blade" onclick="selectRps('blade')"></div>
                                    <div class="rps-btn active" data-val="cube" onclick="selectRps('cube')"></div>
                                    <div class="rps-btn" data-val="membrane" onclick="selectRps('membrane')"></div>
                                </div>
                                <!-- 隐藏的 Input 用于存值 -->
                                <input type="hidden" id="duelMyMove" value="cube">
                
                                <!-- 发起按钮 -->
                                <button onclick="createDuel()" class="cyber-btn" style="width:auto; height:50px; margin:0; border-color:#ff3333; color:#ff3333; padding:0 20px;">
                                    INITIATE<br><span style="font-size:0.7rem">发起挑战</span>
                                </button>
                            </div>
                        </div>
                
                        <!-- 新增：切换标签 -->
                        <div style="display:flex; justify-content:center; gap:30px; margin:20px 0; font-size:0.9rem; color:#666;">
                            <span id="duelTabLobby" class="duel-tab-btn active" onclick="switchDuelTab('lobby')">大厅悬赏</span>
                            <span id="duelTabHistory" class="duel-tab-btn" onclick="switchDuelTab('history')">我的战绩 (回放)</span>
                        </div>
                
                        <!-- 对局列表 -->
                        <div class="duel-list-header">
                            <span>INFO</span>
                            <span>RESULT</span>
                            <span style="text-align:right">ACTION</span>
                        </div>
                        <div id="duelList" class="duel-list-container">
                            <!-- 动态生成 -->
                        </div>
                    </div>
                </div>

                <!-- 2. 发帖 -->
                <div id="view-write" class="view-section" style="display:none;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h2>// CREATE PROJECT</h2>
                        <span id="draftStatus" style="font-size:0.7rem; color:#666; font-style:italic;"></span>
                    </div>
                    <form id="postForm">
                        <select id="postCategory" class="cyber-input" style="margin-bottom:15px; color:var(--accent-blue);">
                            <option value="灌水">🌊 灌水</option>
                            <option value="技术">💻 技术</option>
                            <option value="生活">☕ 生活</option>
                            <option value="提问">❓ 提问Q&A</option>
                        </select>
                        <input type="text" id="postTitle" class="cyber-input full-width" placeholder="标题">
                        <div style="margin-bottom: 10px; display: flex; gap: 10px; align-items: center;">
                            <!-- 修改 accept 属性，增加 video/* -->
                            <!-- 添加 multiple 属性以支持批量选择 -->
                            <input type="file" id="imageUploadInput" accept="image/*,video/*" multiple style="display: none;" onchange="uploadImage()">
                            <button type="button" class="cyber-btn" style="width: auto; padding: 5px 15px; font-size: 0.8rem;" onclick="document.getElementById('imageUploadInput').click()">
                                📷 插入图片
                            </button>
                            <span id="uploadStatus" style="font-size: 0.8rem; color: #666;"></span>
                        </div>
                        <textarea id="postContent" class="cyber-textarea" placeholder="内容"></textarea>
                        <button type="submit" class="cyber-btn big-btn">发布</button>
                    </form>
                </div>

                <!-- 3. 任务页面 -->
                <div id="view-tasks" class="view-section" style="display:none;">
                    <h2>// MISSION CENTER</h2>
                    <div style="display:flex; flex-wrap:wrap; gap:20px;">
                        <!-- 左边：日常任务 -->
                        <div style="flex:1; min-width:300px;">
                            <h3 style="color:var(--accent-blue); border-bottom:1px solid #333; padding-bottom:10px;">📅 日常任务</h3>
                            <div id="dailyTaskList">Loading...</div>
                        </div>
        
                        <!-- 右边：周常任务 -->
                        <div style="flex:1; min-width:300px;">
                            <h3 style="color:#ff00de; border-bottom:1px solid #333; padding-bottom:10px;">⚔️ 周常任务</h3>
                            <div id="weeklyTaskList">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- 4. 文章详情 -->
                <div id="view-post" class="view-section" style="display:none;">
                    <button onclick="window.location.hash='#home'" class="back-btn">< BACK</button>
                    <article id="single-post-content" class="full-article"></article>
                    
                    <!-- 评论区 -->
                    <div class="comments-section">
                        <h3>// 评论终端</h3>
                        <div class="comment-input-box">
                            <textarea id="commentInput" class="cyber-textarea" placeholder="输入你的看法... (支持 Markdown & 图片)" style="height:80px;"></textarea>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                <!-- 上传按钮 -->
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="file" id="commentImgUpload" accept="image/*,video/*" style="display: none;" onchange="uploadCommentImage()">
                                    <button class="cyber-btn" style="width: auto; padding: 5px 10px; font-size: 0.8rem; border-color: #666; color: #aaa;" onclick="document.getElementById('commentImgUpload').click()">
                                        📷 插入媒体
                                    </button>
                                    <span id="commentUploadStatus" style="font-size: 0.8rem; color: #666;"></span>
                                </div>
                                <!-- 发送按钮 -->
                                <button onclick="submitComment()" class="cyber-btn" style="width:auto; margin:0; border-color: var(--accent-blue); color: var(--accent-blue); font-weight: bold;">
                                    发送评论🚀
                                </button>
                            </div>
                            
                        </div>
                        <div id="commentsList" class="comments-list"></div>
                    </div>
                </div>

                <!-- 5. 消息通知 -->
                <div id="view-notifications" class="view-section" style="display:none;">
                    <!-- 顶部操作栏 (已适配移动端) -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:10px;">
                        <h2 style="margin:0;">// SYSTEM LOGS</h2>
                        <div style="display:flex; gap:10px; flex-shrink:0;">
                            <button onclick="clearAllNotifications()" class="cyber-btn danger" style="width:auto; margin:0; padding:5px 15px; font-size:0.8rem;">
                                🗑️ 全部删除
                            </button>
                            <button onclick="markAllRead()" class="cyber-btn" style="width:auto; margin:0; padding:5px 15px; font-size:0.8rem;">
                                ✓ 全部已读
                            </button>
                        </div>
                    </div>
                    <div class="filter-bar" style="margin-bottom: 15px; display:flex; gap:10px; overflow-x:auto; padding-bottom:5px;">
                        <button class="cyber-btn filter-btn active" onclick="filterNotifications('all', this)">全部</button>
                        <button class="cyber-btn filter-btn" onclick="filterNotifications('system', this)">系统</button>
                        <button class="cyber-btn filter-btn" onclick="filterNotifications('reply', this)">回复</button>
                        <button class="cyber-btn filter-btn" onclick="filterNotifications('comment', this)">评论</button>
                        <button class="cyber-btn filter-btn" onclick="filterNotifications('tip', this)">打赏</button>
                    </div>
                    <div id="notifyList" class="posts-grid"></div>
                </div>

                <!-- 6. 用户个人主页 (新增) -->
                <div id="view-profile" class="view-section" style="display:none;">
                    <button onclick="window.history.back()" class="back-btn">< BACK</button>
    
                    <div class="user-profile-header glass-card" style="text-align: center; padding: 30px; border-top: 3px solid var(--accent-blue);">
                        <div id="profileAvatar" style="width: 80px; height: 80px; margin: 0 auto 15px; border: 2px solid #333; border-radius: 8px;"></div>
                        <h2 id="profileName" style="margin: 0; color: #fff;">LOADING</h2>
                        <div id="profileBadges" style="margin: 5px 0;"></div>
                        <p id="profileBio" style="color: #888; font-style: italic; font-size: 0.9rem; margin: 10px 0;">...</p>
        
                        <div class="profile-stats" style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; font-family: 'JetBrains Mono';">
                            <div><div class="stat-num" id="statPosts">0</div><div class="stat-label" style="font-size:0.7rem; color:#666">帖子</div></div>
                            <div><div class="stat-num" id="statFollowers">0</div><div class="stat-label" style="font-size:0.7rem; color:#666">粉丝</div></div>
                            <div><div class="stat-num" id="statFollowing">0</div><div class="stat-label" style="font-size:0.7rem; color:#666">关注</div></div>
                            <div><div class="stat-num" id="statLikes">0</div><div class="stat-label" style="font-size:0.7rem; color:#666">喜欢</div></div>
                        </div>

                        <div id="profileActions">
                        <!-- JS 动态插入 关注/私信 按钮 -->
                        </div>
                    </div>

                    <h3 style="margin-top: 30px; border-bottom: 1px solid #333; padding-bottom: 10px;">// RECENT ACTIVITIES</h3>
                    <div id="profileRecentPosts" class="posts-grid"></div>
                </div>

                <!-- 7. 排行榜视图 -->
                <div id="view-leaderboard" class="view-section" style="display:none;">
                    <h2>// HALL OF FAME</h2>
                    <div class="leaderboard-grid">
                        <!-- 动态生成 -->
                        <div class="loading">Loading ranks...</div>
                    </div>
                </div>

                <!-- 8. 商城视图 (重构版) -->
                <div id="view-shop" class="view-section" style="display:none;">
                    <h2>// ITEM SHOP</h2>
    
                    <!-- 顶部导航栏 -->
                    <div class="shop-tabs-container">
                        <button class="shop-tab-btn active" onclick="switchShopTab('all')">全部</button>
                        <button class="shop-tab-btn" onclick="switchShopTab('vip')">💎 会员</button>
                        <button class="shop-tab-btn" onclick="switchShopTab('decoration')">🎨 装饰</button>
                        <button class="shop-tab-btn" onclick="switchShopTab('consumable')">📦 道具</button>
                    </div>

                    <!-- 商品列表容器 -->
                    <div id="shop-list" class="shop-grid">
                        <!-- JS 动态生成 -->
                    </div>
                </div>

                <!-- 9. 私信与好友视图 -->
                <div id="view-chat" class="view-section" style="display:none;">
                    <div class="chat-layout" style="display:flex; gap:20px; height:80vh;">
                        <!-- 左侧：好友列表与会话 -->
                        <div class="chat-sidebar glass-card" style="flex:1; display:flex; flex-direction:column; min-width:250px;">
                            <div style="padding:10px; border-bottom:1px solid #333; display:flex; gap:10px;">
                                <button class="cyber-btn" onclick="loadFriendList()" style="margin:0; font-size:0.8rem; flex:1;">好友</button>
                                <button class="cyber-btn" onclick="loadConversations()" style="margin:0; font-size:0.8rem; flex:1;">消息</button>
                            </div>
                            <div id="chatList" style="flex:1; overflow-y:auto; padding:10px;">Loading...</div>
                        </div>

                        <!-- 右侧：聊天框 (默认隐藏，点击会话后显示) -->
                        <div id="chatBox" class="chat-main glass-card" style="flex:2; display:none; flex-direction:column;">
                            <div class="chat-header" style="padding:15px; border-bottom:1px solid #333; font-weight:bold;">
                                <span id="chatTargetName">User</span>
                                <button onclick="closeChatBox()" class="mini-action-btn" style="float:right;">关闭</button>
                            </div>
                            <div id="chatMessages" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px;"></div>
                            <div class="chat-input-area" style="padding:10px; border-top:1px solid #333; display:flex; gap:10px;">
                                <input type="text" id="chatInput" class="cyber-input" placeholder="发送私信..." style="margin:0;">
                                <button onclick="sendPrivateMessage()" class="cyber-btn" style="width:auto; margin:0;">SEND</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 10. 个人背包视图 (优化版：带分类) -->
                <div id="view-inventory" class="view-section" style="display:none;">
                    <h2>// MY INVENTORY</h2>

                    <!-- 新增：背包分类导航 -->
                    <div class="shop-tabs-container">
                        <button class="inv-tab-btn active" onclick="switchInventoryTab('all')">全部</button>
                        <button class="inv-tab-btn" onclick="switchInventoryTab('background')">🌌 背景</button>
                        <button class="inv-tab-btn" onclick="switchInventoryTab('post_style')">🖼️ 边框</button>
                        <button class="inv-tab-btn" onclick="switchInventoryTab('bubble')">💬 气泡</button>
                        <button class="inv-tab-btn" onclick="switchInventoryTab('name_color')">🌈 昵称</button>
                        <button class="inv-tab-btn" onclick="switchInventoryTab('consumable')">📦 消耗品</button>
                    </div>

                    <div id="inventoryList" class="shop-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:15px;">
                        Loading...
                    </div>
                </div>

                <!-- 在 index.html 的 view-settings 区域，把"修改昵称"卡片上方或内部加入账号显示 -->
                <!-- 替换 view-settings 部分 -->
                <div id="view-settings" class="view-section" style="display:none;">
                    <h2>// PROFILE SETTINGS</h2>
    
                    <!-- 新增：注册账号显示 -->
                    <div class="glass-card" style="margin-bottom:20px; border-color: #666;">
                        <h3>账号信息</h3>
                        <p style="color:#888; font-size:0.9rem;">您的唯一登录凭证 (不可修改)。</p>
                        <input type="text" id="settingUsername" class="cyber-input" readonly style="color:#888; cursor:not-allowed;">
                    </div>

                    <div class="glass-card">
                        <h3>修改昵称</h3>
                        <p style="color:#666; font-size:0.9rem;">昵称将显示在文章作者栏。</p>
                        <input type="text" id="newNickname" class="cyber-input" placeholder="输入新昵称" maxlength="12">
                        <button onclick="updateProfile()" class="cyber-btn">保存更改 / SAVE</button>
                    </div>

                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>个性签名</h3>
                        <p style="color:#666; font-size:0.9rem;">一句话介绍你自己 (限50字)。</p>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <input type="text" id="settingBio" class="cyber-input" placeholder="输入个性签名..." maxlength="50" style="margin:0; flex:1;">
                            <button onclick="saveBio()" class="cyber-btn" style="margin:0; width:auto;">保存</button>
                        </div>
                    </div>


                    <!-- 新增：自定义头像上传 -->
                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>自定义头像 / CUSTOM AVATAR</h3>
                        <p style="color:#666; font-size:0.9rem;">上传一张图片作为你的头像 (建议正方形)。</p>
                        <div style="display:flex; align-items:center; gap:15px; margin-top:10px;">
                            <!-- 预览区域 -->
                            <div id="settingCustomAvatarPreview" style="width:60px; height:60px; border-radius:8px; overflow:hidden; border:1px solid #333; background:#000;">
                                <!-- 默认空占位 -->
                            </div>
        
                            <label class="cyber-btn" style="margin:0; flex:1; text-align:center; cursor:pointer;">
                                📤 上传图片
                                <input type="file" id="avatarUploadInput" accept="image/*" style="display:none;" onchange="uploadUserAvatar()">
                            </label>
                        </div>
                    </div>
                    
                    <!-- ... (其余部分保持不变: 数字形象, 头衔偏好, 密钥) ... -->
                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>数字形象重构</h3>
                        <p style="color:#666; font-size:0.9rem;">如果不满意当前的像素配色，可以随机重置。</p>
                        <div style="display:flex; align-items:center; gap:15px; margin-top:10px;">
                            <div id="settingAvatarPreview" style="width:50px; height:50px; border:1px solid #333;"></div>
                            <button onclick="randomizeAvatar()" class="cyber-btn" style="margin:0; flex:1;">🎲 随机重置头像</button>
                        </div>
                    </div>
                    <div class="glass-card" style="margin-top: 20px;">
                        <h3>头衔显示偏好</h3>
                        <p style="color:#666; font-size:0.9rem;">选择在名字旁边显示等级数字还是专属称号。</p>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <select id="badgePreferenceSelect" class="cyber-input" style="margin:0; flex:1;">
                                <option value="number">显示等级数字 (LV.X)</option>
                                <option value="title">显示等级称号 (e.g. 赛博神)</option>
                            </select>
                            <button onclick="saveBadgePreference()" class="cyber-btn" style="margin:0; width:auto;">保存</button>
                        </div>
                    </div>
                    <div class="glass-card" style="margin-top: 20px; border-color: var(--accent-blue);">
                        <h3>账户安全密钥 (RECOVERY KEY)</h3>
                        <p style="color:#666; font-size:0.9rem;">这是您找回密码的唯一凭证，请勿泄露。</p>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <input type="text" id="recoveryKeyDisplay" class="cyber-input" readonly style="margin:0; color:var(--accent-blue); letter-spacing:1px;" value="LOADING...">
                            <button onclick="copyRecoveryKey()" class="cyber-btn" style="width:auto; margin:0; white-space:nowrap;">复制</button>
                        </div>
                    </div>

                    <!-- 新增：黑名单管理 -->
                    <div class="glass-card" style="margin-top: 20px; border-color: #ff3333;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3 style="color:#ff3333; margin:0;">黑名单管理 / BLOCK LIST</h3>
                            <button onclick="loadBlockedUsers()" class="mini-action-btn">刷新</button>
                        </div>
                        <p style="color:#666; font-size:0.9rem;">被拉黑的用户无法向您发送私信或评论。</p>
    
                        <div id="blockedListContainer" style="margin-top:10px; max-height:200px; overflow-y:auto;">
                            <!-- JS 动态加载 -->
                            <div style="text-align:center; color:#666; padding:10px;">Loading...</div>
                        </div>
                    </div>
                    
                </div>

                <div id="view-about" class="view-section" style="display:none;">
                    <h2>// SYSTEM LEVELS</h2>
                    <p>通过签到、发帖、评论积累经验值 (XP)，提升权限等级。</p>
                    <table class="tech-table">
                        <thead><tr><th>等级 (LEVEL)</th><th>称号 (TITLE)</th><th>所需经验 (XP)</th></tr></thead>
                        <tbody id="levelTableBody">
                            <!-- JS 动态生成 -->
                        </tbody>
                    </table>
                </div>

                <div id="view-feedback" class="view-section" style="display:none;">
                    <h2>// FEEDBACK CENTER</h2>
                    <p>发现 Bug 或有建议？请告诉管理员。每名用户每日可反馈次数有限。</p>
                    <div class="glass-card">
                        <textarea id="feedbackContent" class="cyber-textarea" placeholder="请详细描述您的问题或建议..." style="height:150px;"></textarea>
                        <button onclick="submitFeedback()" class="cyber-btn">提交反馈</button>
                    </div>
                </div>

                <div id="view-admin" class="view-section" style="display:none;">
                    <h2 style="color:#ff3333">// ADMIN CONSOLE (TOP SECRET)</h2>

                    <!-- 1. 统计数据 -->
                    <div class="stats-row" style="display:flex; gap:20px; margin-bottom:20px;">
                        <div class="glass-card" style="flex:1; text-align:center; border-color:#0070f3;">
                            <div style="font-size:0.8rem; color:#888;">TOTAL USERS</div>
                            <div id="statTotalUsers" style="font-size:2rem; font-weight:bold; color:#fff;">-</div>
                        </div>
                        <div class="glass-card" style="flex:1; text-align:center; border-color:#00ff00;">
                            <div style="font-size:0.8rem; color:#888;">ACTIVE (24H)</div>
                            <div id="statActiveUsers" style="font-size:2rem; font-weight:bold; color:#00ff00;">-</div>
                        </div>
                    </div>

                    <!-- 2. 站点设置 -->
                    <div class="glass-card" style="margin-bottom:20px;">
                        <h3>SYSTEM CONTROL</h3>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span>⚠️ 开启注册邀请码验证</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="inviteToggle" onchange="toggleInviteSystem()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <p style="font-size:0.8rem; color:#666; margin-top:5px;">关闭后，用户注册无需邀请码。</p>
                        <!-- 在 admin 视图的 SYSTEM CONTROL 卡片里添加 -->
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px; border-top:1px dashed #333; padding-top:10px;">
                            <span>🛡️ 登录页 Turnstile 人机验证</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="turnstileToggle" onchange="toggleTurnstile()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>

                    <!-- 3. 邀请码管理 (重构) -->
                    <div class="glass-card" style="border-color:#00ff00; margin-bottom:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <h3>邀请码池</h3>
                            <button onclick="refillInvites()" class="cyber-btn" style="width:auto; margin:0; font-size:0.8rem; border-color:#00ff00; color:#00ff00;">
                                补满10个
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="tech-table" id="adminInviteTable">
                                <thead><tr><th>CODE</th><th>STATUS</th><th>EXPIRE</th><th>ACTION</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 4. 反馈管理 (新增) -->
                    <div class="glass-card" style="border-color:#ffff00; margin-bottom:20px;">
                        <h3>用户反馈</h3>
                        <div class="table-responsive">
                            <table class="tech-table" id="adminFeedbackTable">
                                <thead><tr><th>USER</th><th>CONTENT</th><th>TIME</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 新增封禁列表功能 -->
                    <div class="glass-card" style="border-color:#f33; margin-bottom:20px;">
                        <h3>封禁名单</h3>
                        <div class="table-responsive">
                            <table class="tech-table" id="adminBanTable">
                                <thead><tr><th>USER</th><th>REASON</th><th>EXPIRE</th><th>ACTION</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <div class="glass-card" style="border-color:#bd00ff; margin-top:20px;">
                        <h3>📢 播报审核</h3>
                        <div id="adminBroadcastList">Loading...</div>
                    </div>

                    <div class="glass-card" style="border-color: gold; margin-top: 20px;">
                        <h3>💰 资金调节</h3>
                        <p style="font-size:0.8rem; color:#888;">用于发放补偿、活动奖励或惩罚扣款。</p>
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            <input type="text" id="adminBalanceUser" class="cyber-input" placeholder="用户名" style="flex:1; margin:0;">
                            <input type="number" id="adminBalanceAmount" class="cyber-input" placeholder="金额 (+/-)" style="width:100px; margin:0;">
                            <input type="text" id="adminBalanceReason" class="cyber-input" placeholder="变动理由 (必填)" style="flex:2; margin:0;">
                            <button onclick="adminManageBalance()" class="cyber-btn" style="width:auto; margin:0; border-color:gold; color:gold;">EXECUTE</button>
                        </div>
                    </div>

                    <!-- 管理后台新增：用户搜索卡片 -->
                    <div class="glass-card" style="border-color: #00ccff; margin-top: 20px;">
                        <h3>🔍 用户搜索 / USER SEARCH</h3>
                        <p style="font-size:0.8rem; color:#888;">输入昵称或账号，查询用户的真实 Username 和状态。</p>
    
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <input type="text" id="adminSearchInput" class="cyber-input" placeholder="输入昵称 / 账号..." style="margin:0; flex:1;">
                            <button onclick="adminSearchUsers()" class="cyber-btn" style="width:auto; margin:0; border-color:#00ccff; color:#00ccff;">SEARCH</button>
                        </div>

                        <!-- 搜索结果表格 -->
                        <div class="table-responsive">
                            <table class="tech-table" id="adminUserTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>USERNAME (账号)</th>
                                        <th>NICKNAME (昵称)</th>
                                        <th>余额</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="5" style="text-align:center; color:#666;">等待查询...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 全服福利卡片 -->
                    <div class="glass-card" style="border-color: #ff00de; margin-top: 20px; background: rgba(255, 0, 222, 0.05);">
                        <h3 style="color: #ff00de;">🎁 全服福利发放</h3>
                        <p style="font-size:0.8rem; color:#888;">向 <strong>所有注册用户</strong> (含封禁中) 发放奖励，并发送通知。</p>
                        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items: flex-end;">
                            <div style="flex:1;">
                                <label style="font-size:0.7rem; color:#ff00de;">经验 (XP)</label>
                                <input type="number" id="welfareXp" class="cyber-input" placeholder="0" style="margin:0;">
                            </div>
                            <div style="flex:1;">
                                <label style="font-size:0.7rem; color:#0070f3;">i 币 (Coins)</label>
                                <input type="number" id="welfareCoins" class="cyber-input" placeholder="0" style="margin:0;">
                            </div>
                            <div style="flex:2;">
                                <label style="font-size:0.7rem; color:#ccc;">发放理由</label>
                                <input type="text" id="welfareReason" class="cyber-input" placeholder="例如：中秋节快乐 / 停机维护补偿" style="margin:0;">
                            </div>
                            <button onclick="adminGlobalWelfare()" class="cyber-btn" style="width:auto; margin:0; border-color:#ff00de; color:#ff00de;">🚀 发放</button>
                        </div>
                    </div>

                    <!-- 5. 旧功能 (发布公告、补发密钥、发头衔) -->
                    <div class="glass-card" style="border-color:#ff3333; margin-bottom:20px; background:rgba(255,51,51,0.05);">
                        <h3>📣 发布全站公告</h3>
                        <input type="text" id="adminAnnounceTitle" class="cyber-input" placeholder="公告标题">
                        <textarea id="adminAnnounceContent" class="cyber-textarea" placeholder="公告内容..." style="height:80px;"></textarea>
                        <button onclick="adminPostAnnounce()" class="cyber-btn" style="border-color:#ff3333; color:#ff3333">立即发布公告</button>
                    </div>
                    
                    <div style="display:flex; gap:20px;">
                        <div class="glass-card" style="flex:1; border-color:#bc13fe;">
                            <h3>发放头衔</h3>
                            <input type="text" id="adminTitleUser" class="cyber-input" placeholder="用户名">
                            <div style="display:flex; gap:5px;">
                                <input type="text" id="adminTitleText" class="cyber-input" placeholder="头衔">
                                <input type="color" id="adminTitleColor" value="#00ff00" style="height:42px;width:50px;border:1px solid #333;background:#000;">
                            </div>
                            <button onclick="adminGrantTitle()" class="cyber-btn" style="border-color:#bc13fe;color:#bc13fe;">GRANT</button>
                        </div>
                        <div class="glass-card" style="flex:1; border-color:#888;">
                            <h3>查旧密钥</h3>
                            <input type="text" id="adminTargetUser" class="cyber-input" placeholder="用户名">
                            <button onclick="adminGenKey()" class="cyber-btn" style="border-color:#888;color:#888;">QUERY</button>
                            <div id="adminKeyResult" style="margin-top:5px; color:#0f0; font-weight:bold; font-size:0.8rem; word-break:break-all;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <footer><p>© 2025 1EAK.COOL | SYSTEM ONLINE</p></footer>
        </main>
    </div>
    <!-- 图片查看器 (Lightbox) -->
    <div id="lightbox" class="lightbox">
        <!-- 关闭按钮 -->
        <span class="lightbox-close" onclick="closeLightbox()">×</span>
    
        <!-- 旋转按钮 (改为 SVG 图标) -->
        <div class="lightbox-rotate" onclick="rotateImage(event)">
            <!-- 一个简单的白色刷新图标 -->
            <svg viewBox="0 0 24 24" width="30" height="30" fill="white">
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
        </div>
        <!-- 图片内容 -->
        <img class="lightbox-content" id="lightboxImg" onclick="event.stopPropagation()">
    </div>

    <!-- 移动端底部快捷发帖按钮 (仿微博) -->
    <div id="mobile-post-btn" onclick="window.location.hash='#write'">
        <svg viewBox="0 0 24 24" width="30" height="30" fill="white">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
    </div>
                        
    <script src="script.js?v=8.10"></script>
</body>
</html>
























































